---
import Base from "../layouts/Base.astro";
import { SITE } from "../config/site";
import { Image } from "astro:assets";

// Images
import heroImg from "../assets/images/hero.avif";
import processImg from "../assets/images/IMG_6743.JPG";
import baTitle from "../assets/images/Screen Shot 2020-01-31 at 5.18.58 PM.png";
import smilesImg from "../assets/images/Davinci Corporate image.jpeg";
import session1 from "../assets/images/InSession.jpeg";
import session2 from "../assets/images/InSession2.jpeg";
import logoDark from "../assets/images/logo.png";

// LocalBusiness schema
const schemaLocal = SITE.locations.map((loc) => ({
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  name: `${SITE.name} — ${loc.label}`,
  image: new URL("/favicon.svg", SITE.url).toString(),
  url: SITE.url,
  telephone: loc.phone,
  address: {
    "@type": "PostalAddress",
    streetAddress: loc.street,
    addressLocality: loc.city,
    addressRegion: loc.region,
    postalCode: loc.postal,
    addressCountry: "US",
  },
  areaServed: "Colorado, USA",
  sameAs: Object.values(SITE.social).filter(Boolean),
}));

const PAGE = {
  title:
    "DaVinci Radiance — Professional Teeth Whitening in Lone Tree & Colorado Springs",
  description:
    "Plant & mineral-based teeth whitening. Safe, fast, and low-sensitivity results. Call or text today to schedule your session.",
};

// Load reviews from our API (4★+). Show up to 5 on the homepage.
let reviews: any[] = [];
let placeMeta: { rating?: number; user_ratings_total?: number } = {};
try {
  const apiUrl = new URL("/api/reviews.json", Astro.url).toString();
  const r = await fetch(apiUrl);
  const data = await r.json();
  reviews = (data?.reviews ?? []).slice(0, 5);
  placeMeta = {
    rating: data?.rating,
    user_ratings_total: data?.user_ratings_total,
  };
} catch (_) {}

// Build a direct Google Maps link to the Business Profile using Place ID.
// Prefer SITE.googlePlaceId if you added it to your config; else use env; else no-op '#'.
const PLACE_ID =
  (SITE as any)?.googlePlaceId ??
  import.meta.env.GOOGLE_PLACE_ID ??
  null;

const GOOGLE_REVIEWS_URL = PLACE_ID
  ? `https://search.google.com/local/reviews?placeid=${PLACE_ID}`
  : "#";
---

<Base title={PAGE.title} description={PAGE.description} schema={schemaLocal}>
  <!-- ANNOUNCEMENT BAR -->
  <div class="bg-emerald-50 ring-1 ring-emerald-100">
    <div class="mx-auto max-w-7xl px-4 py-2 text-center text-sm text-emerald-900">
      <span class="mr-2 inline-block h-2 w-2 rounded-full bg-emerald-500 align-middle"></span>
      Now serving <strong>Lone Tree</strong> & <strong>Colorado Springs</strong>
    </div>
  </div>

  <!-- HERO -->
  <section class="relative mx-auto max-w-7xl px-4 pt-8 md:pt-12">
    <div class="grid items-center gap-8 md:grid-cols-2">
      <div class="max-w-[600px]">
        <h1 class="text-pretty text-3xl/tight font-semibold text-slate-900 sm:text-4xl md:text-5xl">
          Your Best Smile Starts Here.
        </h1>
        <p class="mt-4 text-slate-600">
          Professional teeth whitening using FDA-approved plant & mineral-based
          gels. Safe, fast, and low sensitivity.
        </p>

        <!-- One primary CTA up top (sticky bar handles redundancy on mobile) -->
        <div class="mt-6 flex flex-wrap gap-3">
          <a
            href={`tel:${SITE.phone}`}
            class="inline-flex items-center justify-center rounded-lg bg-emerald-600 px-5 py-3 font-semibold text-white shadow-sm hover:bg-emerald-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-600 focus-visible:ring-offset-2"
          >
            Call {SITE.phoneHuman}
          </a>
          <a
            href={`sms:${SITE.sms}`}
            class="inline-flex items-center justify-center rounded-lg border border-emerald-600 px-5 py-3 font-semibold text-emerald-700 hover:bg-emerald-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-600 focus-visible:ring-offset-2"
          >
            Text Us to Schedule
          </a>
        </div>

        <div
          class="mt-6 flex flex-wrap items-center gap-x-6 gap-y-3 text-sm text-slate-700"
        >
          <div class="inline-flex items-center gap-2">
            <span class="inline-block h-2 w-2 rounded-full bg-emerald-500"></span>
            FDA Approved
          </div>
          <div class="inline-flex items-center gap-2">
            <span class="inline-block h-2 w-2 rounded-full bg-emerald-500"></span>
            Plant & Mineral Based
          </div>
          <div class="inline-flex items-center gap-2">
            <span class="inline-block h-2 w-2 rounded-full bg-emerald-500"></span>
            Low Sensitivity
          </div>
          <div class="inline-flex items-center gap-2">
            <span class="inline-block h-2 w-2 rounded-full bg-emerald-500"></span>
            Locally Owned
          </div>
        </div>
      </div>

      <div class="overflow-hidden rounded-2xl shadow-sm ring-1 ring-black/5">
        <Image
          src={heroImg}
          alt="Smiling client outdoors in Colorado winter"
          widths={[480, 768, 1024, 1280, 1600]}
          sizes="(max-width: 768px) 100vw, 48rem"
          loading="eager"
          decoding="async"
          class="block"
        />
      </div>
    </div>
  </section>

  <!-- BEFORE / AFTER (header image) -->
  <section class="mx-auto mt-10 max-w-6xl px-4">
    <div class="text-center">
      <Image
        src={baTitle}
        alt="Before and After"
        widths={[480, 640, 800]}
        sizes="(max-width: 768px) 90vw, 48rem"
        class="mx-auto h-auto w-full max-w-2xl"
        loading="lazy"
        decoding="async"
      />
    </div>
    <p class="mt-3 text-center text-sm text-slate-500">
      Real DaVinci Radiance clients — individual results vary.
    </p>
  </section>

  <!-- PROCESS -->
  <section class="mt-16 bg-slate-50/70 py-12 ring-1 ring-slate-200/60">
    <div class="mx-auto grid max-w-7xl items-center gap-10 px-4 md:grid-cols-2">
      <div class="max-w-[560px]">
        <h2 class="text-2xl font-semibold text-slate-900">
          Whitening in 3 Simple Steps
        </h2>

        <ol class="mt-5 space-y-4 text-slate-700">
          <li class="flex gap-3">
            <span
              class="mt-0.5 inline-flex h-7 w-7 flex-none items-center justify-center rounded-full bg-emerald-100 font-semibold text-emerald-800 ring-1 ring-emerald-200"
              >1</span
            >
            <span>Apply whitening gel (upper & lower arch)</span>
          </li>
          <li class="flex gap-3">
            <span
              class="mt-0.5 inline-flex h-7 w-7 flex-none items-center justify-center rounded-full bg-emerald-100 font-semibold text-emerald-800 ring-1 ring-emerald-200"
              >2</span
            >
            <span>Blue LED light activation</span>
          </li>
          <li class="flex gap-3">
            <span
              class="mt-0.5 inline-flex h-7 w-7 flex-none items-center justify-center rounded-full bg-emerald-100 font-semibold text-emerald-800 ring-1 ring-emerald-200"
              >3</span
            >
            <span>Rinse & reveal a radiant smile</span>
          </li>
        </ol>

        <div class="mt-6 flex flex-wrap gap-3">
          <a
            href={`tel:${SITE.phone}`}
            class="inline-flex items-center justify-center rounded-lg bg-emerald-600 px-5 py-3 font-semibold text-white shadow-sm hover:bg-emerald-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-600 focus-visible:ring-offset-2"
            >Call to Schedule</a
          >
          <a
            href={`sms:${SITE.sms}`}
            class="inline-flex items-center justify-center rounded-lg border border-emerald-600 px-5 py-3 font-semibold text-emerald-700 hover:bg-emerald-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-600 focus-visible:ring-offset-2"
            >Text Us a Question</a
          >
        </div>
      </div>

      <div class="overflow-hidden rounded-2xl bg-white shadow-sm ring-1 ring-black/5">
        <Image
          src={processImg}
          alt="Client under LED light during whitening"
          widths={[480, 768, 1152]}
          sizes="(max-width: 768px) 100vw, 42rem"
          loading="lazy"
          decoding="async"
          class="block"
        />
      </div>
    </div>
  </section>

  <!-- GROUP EVENTS -->
  <section
    class="mx-auto mt-16 max-w-7xl rounded-2xl bg-emerald-50/60 px-4 py-8 ring-1 ring-emerald-100"
  >
    <h2 class="text-2xl font-semibold text-slate-900">
      Group Events & Specials
    </h2>
    <p class="mt-2 max-w-3xl text-slate-700">
      Planning a big day? We offer <span class="font-semibold">special rates for groups</span>—perfect
      for wedding parties, engagement shoots, birthdays, reunions, prom groups,
      corporate teams, pageant squads, and creator bundles.
    </p>
    <ul class="mt-4 grid gap-2 text-slate-700 sm:grid-cols-2">
      <li>• Wedding parties & engagement shoots</li>
      <li>• Birthdays & family reunions</li>
      <li>• Prom groups & pageant teams</li>
      <li>• Corporate headshots & team events</li>
      <li>• Creator/content bundles</li>
    </ul>
    <div class="mt-5 flex flex-wrap gap-3">
      <a
        href={`tel:${SITE.phone}`}
        class="rounded-lg bg-emerald-600 px-5 py-3 font-semibold text-white shadow-sm hover:bg-emerald-700"
        >Call for a Group Quote</a
      >
      <a
        href={`sms:${SITE.sms}`}
        class="rounded-lg border border-emerald-600 px-5 py-3 font-semibold text-emerald-700 hover:bg-emerald-50"
        >Text Your Event Details</a
      >
    </div>
    <p class="mt-2 text-sm text-slate-600">
      We’ll tailor your session count, timing, and location for your group—ask
      about on-site options.
    </p>
  </section>

  <!-- REVIEWS -->
  <section class="mx-auto mt-16 max-w-7xl px-4">
    <div class="flex items-end justify-between gap-4">
      <div>
        <h2 class="text-2xl font-semibold text-slate-900">
          Clients Love Their Results
        </h2>
        {placeMeta?.rating && placeMeta?.user_ratings_total && (
          <p class="mt-1 text-slate-600">
            Google rating <span class="font-medium">{placeMeta.rating}</span
            >/5 · {placeMeta.user_ratings_total} reviews
          </p>
        )}
      </div>
      <a
        href={GOOGLE_REVIEWS_URL}
        target="_blank"
        rel="noopener"
        class="text-sm font-semibold text-emerald-700 hover:text-emerald-800"
        >See all reviews on Google →</a
      >
    </div>

    <!-- Grid on desktop, horizontal scroll on mobile for better use of space -->
    <div
      class="mt-6 grid gap-6 sm:grid-cols-2 lg:grid-cols-3 [--card-w:20rem] sm:[--card-w:auto] overflow-x-auto sm:overflow-visible pb-1"
      style="scroll-snap-type:x mandatory"
    >
      {reviews.length === 0 && (
        <div class="rounded-xl border border-slate-200 p-5 text-slate-600">
          Reviews will appear here soon.
        </div>
      )}

      {reviews.map((rv) => (
        <article
          class="min-w-[var(--card-w)] scroll-snap-align-start rounded-xl border border-slate-200 bg-white p-5 shadow-sm"
        >
          <div class="flex items-center gap-3">
            {rv.profile_photo_url && (
              <img
                src={rv.profile_photo_url}
                alt={rv.author_name}
                width="40"
                height="40"
                class="h-10 w-10 rounded-full"
              />
            )}
            <div>
              <div class="font-medium text-slate-900">{rv.author_name}</div>
              <div class="text-sm text-slate-500">{rv.time_desc}</div>
            </div>
          </div>
          <div
            class="mt-3 text-amber-500"
            aria-label={`${rv.rating} out of 5 stars`}
          >
            {"★★★★★".slice(0, rv.rating)}
            <span class="text-slate-300">
              {"★★★★★".slice(rv.rating)}
            </span>
          </div>
          <p class="mt-3 whitespace-pre-wrap text-slate-700">{rv.text}</p>
        </article>
      ))}
    </div>
  </section>

  <!-- SOCIAL / GALLERY -->
  <section class="mx-auto mt-16 max-w-7xl px-4">
    <div class="grid gap-6 md:grid-cols-2">
      <div class="overflow-hidden rounded-2xl ring-1 ring-black/5">
        <Image
          src={smilesImg}
          alt="Happy clients smiling after whitening"
          widths={[480, 768, 1000]}
          sizes="(max-width: 768px) 100vw, 36rem"
          loading="lazy"
          decoding="async"
          class="block"
        />
      </div>
      <div class="grid gap-6">
        <div class="overflow-hidden rounded-2xl ring-1 ring-black/5">
          <Image
            src={session1}
            alt="In-session whitening with LED light"
            widths={[480, 768, 1152]}
            sizes="(max-width: 768px) 100vw, 36rem"
            loading="lazy"
            decoding="async"
            class="block"
          />
        </div>
        <div class="overflow-hidden rounded-2xl ring-1 ring-black/5">
          <Image
            src={session2}
            alt="Whitening device in use during session"
            widths={[480, 768, 1152]}
            sizes="(max-width: 768px) 100vw, 36rem"
            loading="lazy"
            decoding="async"
            class="block"
          />
        </div>
      </div>
    </div>
  </section>

  <!-- LOCATIONS + CTA -->
  <section
    class="mx-auto mt-16 max-w-7xl rounded-2xl bg-slate-50 px-4 py-8 ring-1 ring-slate-200"
  >
    <div class="grid gap-6 md:grid-cols-3">
      <div class="flex items-center gap-3">
        <div class="h-10 w-10 overflow-hidden rounded">
          <Image src={logoDark} alt="DaVinci Radiance mark" widths={[40]} class="h-10 w-10" />
        </div>
        <div>
          <div class="font-semibold text-slate-900">Two Colorado Locations</div>
          <div class="text-sm text-slate-600">Lone Tree & Colorado Springs</div>
        </div>
      </div>
      <ul class="space-y-3 text-sm text-slate-700">
        {SITE.locations.map((loc) => (
          <li class="rounded-lg border border-slate-200 p-3">
            <div class="font-medium">{loc.label}</div>
            <div class="text-slate-600">{loc.street}</div>
            <div class="text-slate-600">
              {loc.city}, {loc.region} {loc.postal}
            </div>
          </li>
        ))}
      </ul>
      <div class="grid content-start gap-3">
        <a
          href={`tel:${SITE.phone}`}
          class="rounded-lg bg-emerald-600 px-5 py-3 text-center font-semibold text-white shadow-sm hover:bg-emerald-700"
          >Call Now</a
        >
        <a
          href={`sms:${SITE.sms}`}
          class="rounded-lg border border-emerald-600 px-5 py-3 text-center font-semibold text-emerald-700 hover:bg-emerald-50"
          >Text Us Today</a
        >
      </div>
    </div>
  </section>

  <!-- Spacer so the mobile fixed CTA doesn't cover the footer -->
  <div class="h-24 md:hidden"></div>
</Base>

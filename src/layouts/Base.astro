---
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import { SITE } from "../config/site";
import "../styles/global.css";
import Analytics from '@vercel/analytics/astro'

// Props you can override per page
export interface Props {
  title?: string;
  description?: string;
  noindex?: boolean;
  ogImage?: string;            // absolute or path from /public
  twitter?: {
    card?: 'summary' | 'summary_large_image';
    creator?: string;
  };
  schema?: Record<string, any> | Record<string, any>[]; // JSON-LD object(s)
}

const {
  title = "DaVinci Radiance â€” Teeth Whitening in Colorado",
  description = "Plant & mineral-based teeth whitening. Safe, fast, low-sensitivity results in Lone Tree and Colorado Springs.",
  noindex = false,
  ogImage = "/og-default.jpg",
  twitter = { card: "summary_large_image", creator: "@yourhandle" },
  schema = []
} = Astro.props;

const url = new URL(Astro.url.pathname, SITE.url).toString();

// Serialize JSON-LD (accept single object or array)
const schemas = Array.isArray(schema) ? schema : [schema].filter(Boolean);

// Minimal system font stack = no FOUT/FCLS
const themeColor = "#0A2342";
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="theme-color" content={themeColor} />

    {noindex && (
      <>
        <meta name="robots" content="noindex, nofollow" />
        <meta name="googlebot" content="noindex, nofollow" />
      </>
    )}

    <!-- Canonical & basic SEO -->
    <link rel="canonical" href={url} />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content={SITE.name} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:url" content={url} />
    <meta property="og:image" content={ogImage.startsWith("http") ? ogImage : new URL(ogImage, SITE.url).toString()} />

    <meta name="twitter:card" content={twitter.card ?? "summary_large_image"} />
    {twitter.creator && <meta name="twitter:creator" content={twitter.creator} />}
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImage.startsWith("http") ? ogImage : new URL(ogImage, SITE.url).toString()} />

    <!-- Favicons (drop these files in /public) -->
    <link rel="icon" href="/favicon.png" sizes="any" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />

    <!-- Preconnects (safe defaults) -->
    <link rel="preconnect" href={new URL(SITE.url).origin} crossorigin />

    <!-- JSON-LD Organization & Website (base). Pages can pass more via `schema` prop -->
    <script type="application/ld+json">
      {JSON.stringify({
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": SITE.name,
        "url": SITE.url,
        "logo": new URL("/favicon.svg", SITE.url).toString(),
        "sameAs": Object.values(SITE.social).filter(Boolean),
        "contactPoint": [{
          "@type": "ContactPoint",
          "telephone": SITE.phone,
          "contactType": "customer service",
          "areaServed": "US",
          "availableLanguage": ["en"]
        }]
      })}
    </script>

    <script type="application/ld+json">
      {JSON.stringify({
        "@context": "https://schema.org",
        "@type": "WebSite",
        "url": SITE.url,
        "name": SITE.name,
        "potentialAction": {
          "@type": "SearchAction",
          "target": `${SITE.url}/search?q={search_term_string}`,
          "query-input": "required name=search_term_string"
        }
      })}
    </script>

    {schemas.map((obj) => (
      <script type="application/ld+json">{JSON.stringify(obj)}</script>
    ))}

    <!-- Partytown: any third-party scripts should use type="text/partytown" on pages -->
    {/* Example:
      <script type="text/partytown" src="https://www.googletagmanager.com/gtag/js?id=GA_ID"></script>
      <script type="text/partytown">
        {`window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config','GA_ID');`}
      </script>
    */}
  </head>

  <body class="min-h-dvh bg-white text-slate-800 antialiased">
    <a href="#main" class="sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 focus:z-50 rounded bg-emerald-600 px-3 py-1.5 text-white">
      Skip to content
    </a>

    <Header />

    <main id="main" class="mx-auto max-w-7xl px-4 lg:px-8">
      <slot />
    </main>

    <Footer />
    <Analytics/>
  </body>
</html>
